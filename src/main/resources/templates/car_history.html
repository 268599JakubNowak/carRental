<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Historia wypożyczeń auta</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
<h1>Historia wypożyczeń auta</h1>

<form id="carForm" class="mb-4">
    <label for="carBrand" class="form-label">Marka auta:</label>
    <input type="text" id="carBrand" class="form-control" placeholder="Wprowadź markę auta, np. Toyota" required>
    <button type="submit" class="btn btn-primary mt-2">Pobierz historię</button>
</form>

<table class="table table-bordered table-striped" id="historyTable" style="display: none;">
    <thead>
    <tr>
        <th>Samochód</th>
        <th>Klient</th>
        <th>Od</th>
        <th>Do</th>
    </tr>
    </thead>
    <tbody id="historyBody">
    </tbody>
</table>

<script>
        document.getElementById('carForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const carBrand = document.getElementById('carBrand').value;
            fetch(`/api/cars/history?brand=${encodeURIComponent(carBrand)}`)
                .then(response => {
                    if (!response.ok) throw new Error("Błąd pobierania danych.");
                    return response.json();
                })
                .then(data => {
                    const table = document.getElementById('historyTable');
                    const tbody = document.getElementById('historyBody');
                    tbody.innerHTML = '';
                    if (data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4">Brak rezerwacji dla aut o podanej marce.</td></tr>';
                    } else {
                        data.forEach(entry => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${entry.carInfo}</td>
                                <td>${entry.customerName}</td>
                                <td>${entry.rentedFrom}</td>
                                <td>${entry.rentedTo}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    table.style.display = 'table';
                })
                .catch(error => alert("Wystąpił błąd: " + error.message));
        });
    </script>
</body>
</html>
